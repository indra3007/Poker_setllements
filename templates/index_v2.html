<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ° Poker Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon.png') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>ğŸ° Poker Tracker</h1>
            <p class="subtitle">Track events, calculate settlements</p>
        </header>

        <!-- Home Screen - Event List -->
        <div id="home-screen">
            <div class="home-header">
                <h2>ğŸ“‹ Your Poker Events</h2>
                <button class="btn btn-primary btn-large" id="create-new-event-btn">+ Create New Event</button>
            </div>
            
            <div id="events-grid">
                <!-- Event cards will be dynamically added here -->
            </div>
            
            <div id="no-events-message" class="info-box" style="display: none; text-align: center; margin-top: 40px;">
                <h3>ğŸ² No Events Yet</h3>
                <p>Create your first poker event to get started!</p>
                <p>Track players, chips, and calculate settlements automatically.</p>
            </div>
        </div>

        <!-- Event View - Hidden by Default -->
        <div id="event-view" style="display: none;">
            <!-- Back Button -->
            <div class="back-button-container">
                <button class="btn btn-secondary" id="back-to-home">â† Back to Events</button>
                <h2 id="current-event-name" style="display: inline-block; margin-left: 15px; color: #1DA1F2;"></h2>
            </div>

            <!-- Tab Navigation -->
            <div class="tabs">
                <button class="tab active" data-tab="players">ğŸ‘¥ Players</button>
                <button class="tab" data-tab="settlements">ğŸ’° Settlements</button>
                <button class="tab" data-tab="charts">ğŸ“Š Charts</button>
            </div>

            <!-- Players Tab -->
            <div id="players-tab" class="tab-content active">
                <div class="action-buttons">
                    <button class="btn btn-primary" id="add-player">+ Add Player</button>
                    <button class="btn btn-success" id="save-data">ğŸ’¾ Save</button>
                    <button class="btn btn-danger" id="clear-data">ğŸ—‘ï¸ Clear Event</button>
                </div>

                <div class="table-container">
                    <table id="players-table" class="players-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Start $</th>
                                <th>Buy-ins</th>
                                <th>Day 1</th>
                                <th>Day 2</th>
                                <th>Day 3</th>
                                <th>Day 4</th>
                                <th>Day 5</th>
                                <th>Day 6</th>
                                <th>Day 7</th>
                                <th>P/L</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="players-tbody">
                            <!-- Players will be dynamically added here -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="3"><strong>TOTALS</strong></td>
                                <td id="total-buyins">0</td>
                                <td id="total-day1">$0</td>
                                <td id="total-day2">$0</td>
                                <td id="total-day3">$0</td>
                                <td id="total-day4">$0</td>
                                <td id="total-day5">$0</td>
                                <td id="total-day6">$0</td>
                                <td id="total-day7">$0</td>
                                <td id="total-pl">$0</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="summary-box">
                    <h3>ğŸ“Š Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="label">Total Players:</span>
                            <span class="value" id="total-players">0</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Total Profit:</span>
                            <span class="value positive" id="total-profit">$0</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Total Loss:</span>
                            <span class="value negative" id="total-loss">$0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settlements Tab -->
            <div id="settlements-tab" class="tab-content">
                <div class="settlements-header">
                    <h2>ğŸ’° Smart Settlements</h2>
                    <p>Who pays whom - track payments</p>
                </div>

                <button class="btn btn-primary btn-large" id="calculate-settlements">ğŸ”„ Calculate Settlements</button>

                <div id="settlements-container">
                    <div class="info-box">
                        <p>ğŸ’¡ Click "Calculate Settlements" to see who pays whom</p>
                        <p>The algorithm minimizes the number of transactions needed</p>
                    </div>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="charts-tab" class="tab-content">
                <div class="action-buttons">
                    <button class="btn btn-primary" id="refresh-charts">ğŸ”„ Refresh Charts</button>
                </div>

                <div id="charts-container">
                    <canvas id="profit-loss-chart" style="max-height: 300px; margin-bottom: 20px;"></canvas>
                    <canvas id="chips-trend-chart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <!-- End of Event View -->

        <!-- Footer -->
        <footer>
            <p>Made with â¤ï¸ for poker nights</p>
        </footer>
    </div>

    <!-- New Event Modal -->
    <div id="event-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Create New Event</h3>
            <label for="event-name-input" style="font-weight: bold; color: #1DA1F2; margin-bottom: 5px; display: block;">Event Name:</label>
            <input type="text" id="event-name-input" placeholder="e.g., Christmas, New Year Party">
            <label for="event-date-input" style="font-weight: bold; color: #1DA1F2; margin-bottom: 5px; margin-top: 15px; display: block;">Event Date:</label>
            <input type="date" id="event-date-input">
            <div class="modal-buttons">
                <button class="btn btn-success" id="create-event-btn">Create</button>
                <button class="btn btn-secondary" id="cancel-event-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='script_v2.js') }}"></script>
</body>
</html>
